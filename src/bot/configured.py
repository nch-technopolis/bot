from datetime import date

import chatterbot

from .actions import BirthDayCongratulation, SendRandomMessage, at
from .api.telegram import BotAPI
from .api.vk import API as VkAPI
from .bot import Bot, Chats
from .config import (
    API_TOKEN, BOT_USERNAME, CHATTER_BOT_DB_URI, VK_CLIENT_ID,
    VK_AUTH_REDIRECT_URI,
)
from .dialog import chatter_bot_dialog
from .replies import (
    RandomPhoto, RandomReply, StartDialog, VkAuth, text_contains, text_message,
    video_message,
)
from . import store as _store


class StoredChats(Chats):
    def __init__(self, store):
        self._store = store

    def add(self, chat_id):
        return self._store.add_chat(chat_id)

    def remove(self, chat_id):
        return self._store.remove_chat(chat_id)

    def __iter__(self):
        return iter(self._store.get_chats())


REPLIES_WEEKEND = [
    'Сегодня пятница! Пора раслабится! проблемы в задницу! и все наладится!',
    'Хорошо отдохнуть в выходные!',
    'Урааа! наша любимая пятница пришла...',
    'Ура!!! мы дожили до пятницы',
    'Дождались! Пятницы!!!',
    'Пятница хоть и небольшой праздник, но зато постоянный',
    'Эх раз! Еще раз! Сегодня пятница у нас!',
    'Вот и пятница пришла! Оставляй-ка, друг заботы, можно жить и без работы!',
]

REPLIES_MORNING = [
    'Доброе утро братва!!! Прекрасного вам дня!',
    'Доброе утро друзья! Всем хорошего настроения и приятного вам дня!!',
    'Утро добрым не бывает, если кофев чашке нет! наливаем чашку кофе и заходим в интернет! Доброе утро!',
    'Счастья, радости, тепла. С добрым утром вас друзья',
    'Самого доброго утра, Всем лучей добра, друзья!',
    'Доброе утро друзья! Пусть все будет хорошо!',
    'Захожу я в интернет. Всем большой большой привет. Я про Вас не забываю. Всем удачи я желаю. хорошего настроения.',
    'Доброе утро, дорогие друзья! Чай или кофе попейте с утра. Новому дню прокричите Ура!',
]

REPLIES = [
    'совсем дерадировали...',
    'сука подстава...',
    'вы че блять угорать решили',
    'нету развити, вы загнетесь как черви',
    'юморист хренов',
    'чтоб у вас мозги от хардкора повылетали',
    'леха косит под витю',
    'Ленар в Питере???',
    'леха бухой алкаш',
    'Леха алкоголик...',
    'Ленар плохой он предатель перестал со мной общаться он кинул меня',
    'Артем меня Чекатилой обзывает????',
    'Пацаны я нормальный стал! пошли пиво пить???? я угощаю',
    '((((((((((',
    'Ты понял сам какую херню ты мне написал сам...',
    'ты вообще вминяемый или нет? или гомосек',
    'а??',
    'какого хрена так пишешь ты адекватный вообще нормальный?',
]

REPLIES_BDAY = [
    'У тебя случилась днюха, Вот какая заваруха! Я тебя сто лет уж знаю, А поэтому желаю Оставаться крутым перцем С любящим широким сердцем, Достигать вершин успеха, Чтоб ушли к чертям помехи. Умножай свои богатства И не знай слова «лекарство». Ты за хвост держи удачу, Впереди будь, не иначе. Только супернастроения! В общем, друг мой, с днем рождения!',
    'Дружище, с днем рождения тебя! Будь всегда на позитиве. Радуйся каждый день, наслаждайся мелочами, стремись к своим мечтам и всегда дари добро. Пусть у тебя будет порядок в делах и лад в личной жизни. Достатка, независимости и крепкого здоровья!',
    'Поздравляю с днем рождения! Желаю сто причин для счастья, тысячу поводов для веселья и миллион возможностей для беззаботной жизни. Оставайся всегда и везде самим собой и береги в себе человека. Будь свободен в мыслях, поступках, чувствах. Живи душой, мечтай сердцем, улыбайся мыслям. Пусть жизнь будет прекрасной песней. Дорожу нашей дружбой!',
    'Дорогой мой друг, с днем рождения! Хочется пожелать тебе всего недостающего для полного счастья, чтобы все задумки и планы реализовались. Огромных тебе материальных доходов, крепких жизненных сил, позитивных действий, самой искренней и преданной любви и, конечно, уверенности в завтрашнем дне, ни в чём не нуждаться и идти смело победителем по жизни.',
    'С днем рождения, дружище! Желаю оставаться таким же человечным, искренним, добрым. Пусть на твоем жизненном пути встречаются только хорошие люди, а зло обходит стороной. Пусть удача сопутствует во всем, а каждое начинание заканчивается успехом. Пусть любовь всегда живет в твоем сердце. И, конечно же, львиного здоровья тебе и стойкости духа!',
    'Дружище, поздравляю тебя с днем рождения! Пусть задуманное сбывается, хорошее умножается, плохое уходит, а счастье делится на всю твою семью. Желаю не останавливаться на достигнутом, идти вперед при любых обстоятельствах, покорять вершины и новые горизонты, любить жизнь и быть ее хозяином!',
    'Дружище, с днем рождения! Желаю тебе множество побед, удачи и счастливых случаев. Пусть каждый день радует, вызывает улыбку и хорошее настроение. Любви тебе, здоровья, развития и достижения всех желанных целей. Будь счастлив и целеустремлен! Пусть у тебя всё получается. Хорошо повеселись, чтобы было что вспомнить!',
    'Ну что, дружище, вот ты и повзрослел еще на год. Желаю тебе сил и терпения, чтобы воплотить все свои задумки и желания. Пусть твоя жизнь будет счастливая и полная радости, а удача никогда не подводит. Поздравляю тебя с днём рождения!',
    'Дружище! Ты самый позитивный и веселый человек, которого я знаю! С тобой всегда легко и необычайно интересно, поэтому никогда не изменяй самому себе и оставайся собой в любой ситуации! В твой день рождения хочу пожелать тебе самых ярких событий, отличного здоровья, любви и невероятных жизненных перспектив!',
    'Дорогой мой друг! Желаю чтоб в твоей жизни случались только правильные события, чтоб попутный ветер дул в нужную сторону, а мечты всегда реализовывались. И чтоб вопреки всему каждый год добавлял тебе еще больше мудрости, мужества и уверенности! С днем рождения!',
    'Дружище, от сердца поздравляю тебя с днём рождения! Наилучших тебе благ в жизни, крепкого фундамента под ногами, счастливого семейного гнёздышка, достаточно финансов для беспечного быта и незабываемых развлечений. Удачи тебе повсюду и самых завораживающих впечатлений.',
    'Дорогой дружище, поздравляю тебя с твоим днём рождения и желаю уверено подниматься к вершинам успеха и счастья, быть всегда в отличной форме и чудесном настроении, не терять доброй надежды и верной любви, радоваться жизни и получать удовольствие от каждого проведённого дня.',
]


def denis(chats_cls=StoredChats):
    access_token = _store.get_vk_access_token()
    vk = VkAPI(access_token.get('access_token'))
    engine = chatterbot.ChatBot(
        'Денис Емельянов',
        storage_adapter='chatterbot.storage.SQLStorageAdapter',
        database_uri=CHATTER_BOT_DB_URI,
        math_words_language='russian',
    )
    replies = (
        RandomPhoto(5561827, vk, trigger=text_contains('денис', 'скинь фотку')),
        VkAuth(
            VK_AUTH_REDIRECT_URI,
            VK_CLIENT_ID,
            trigger=text_contains('денис', 'дай зайти в вк'),
        ),
        RandomReply(
            trigger=video_message,
            replies=('когда снято это видео???у меня вопрос ?????какой год????',),
        ),
        StartDialog(
            start_trigger=text_contains('денис', 'поговорим?'),
            stop_trigger=text_contains('денис', 'пока'),
            dialog_factory=chatter_bot_dialog(engine),
            trigger=text_message,
        ),
        RandomReply(
            replies=REPLIES,
            trigger=text_contains('денис'),
        ),
    )

    actions = (
        SendRandomMessage(
            messages=REPLIES_WEEKEND,
            trigger=at(weekday=4, hour=13, minute=30),
        ),
        SendRandomMessage(
            messages=REPLIES_MORNING,
            trigger=at(hour=6, minute=10),
        ),
        BirthDayCongratulation(
            bdays=(
                (date(2019, 1, 17), 'Леха'),
                (date(2019, 3, 7), 'Ваня'),
                (date(2019, 3, 14), 'Рустам'),
                (date(2019, 4, 25), 'Азат'),
                (date(2019, 4, 26), 'Славян'),
                (date(2019, 5, 5), 'Ленар'),
                (date(2019, 8, 17), 'Колян'),
                (date(2019, 8, 18), 'Владян'),
                (date(2019, 8, 20), 'Артем братан'),
                (date(2019, 12, 6), ''),
                (date(2019, 12, 26), 'Санек'),
            ),
            messages=REPLIES_BDAY,
            trigger=at(hour=6, minute=15),
        )
    )

    return Bot(
        api=BotAPI(API_TOKEN),
        chats=chats_cls(_store),
        username=BOT_USERNAME,
        replies=replies,
        actions=actions,
    )
